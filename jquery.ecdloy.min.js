;(function(a){a.ecdloy=function(b,c){var d=this;d.$el=a(b);d.timer=null;d.curIdx=0;d.endNum=-1;d.prevIdx=-1;d.$prevItem=null;d.$curItem=null;d.code=0;d.interLoop=0;d.isSpinning=false;d.$el.data("ecdloy",d);d.init=function(){d.opts=a.extend(new Object(),a.ecdloy.defaults,c);d.interval=d.opts.interval;d.$items=d.$el.find(d.opts.cssItem);d.$items.each(function(e,f){if(!f.getAttribute("data-loysn")){f.setAttribute("data-loysn",e)}});a(d.opts.spinner).bind("click",function(f){if(!d.isSpinning){d.playLoy()}});d.total=d.$items.length;d.interLoop=d.opts.interLoop*d.total};d.showItem=function(e){e=e<0?1:e;e=e>(d.total)?1:e;this.prevIdx=d.curIdx;this.curIdx=e;(d.$curItem&&d.$curItem.removeClass(d.opts.clItemActive));d.$prevItem=d.$curItem;var f='[data-loysn="%"]'.replace("%",e+"");d.$curItem=d.$items.filter(f).addClass(d.opts.clItemActive)};d.stop=function(){clearInterval(d.timer);if(a.isFunction(d.opts.onWin)){d.opts.onWin(this.code)}d.isSpinning=false;d.reset()};d.playLoy=function(){d.isSpinning=true;if(a.isFunction(d.opts.onStart)){d.opts.onStart()}a.ajax({url:d.opts.sn+"&"+new Date().getTime(),timeout:20000,dataType:"json",error:function(){d.isSpinning=false;if(a.isFunction(d.opts.error)){d.opts.error()}},success:function(g){var e=g.errno;var f=g.message;d.code=g;if(e==0){d.run();setTimeout(function(){d.endNum=g.success_code},d.opts.interRlt)}else{d.isSpinning=false;if(a.isFunction(d.opts.complete)){d.opts.complete(g)}}}});return false};d.reset=function(){d.endNum=-1;d.code=0;d.interval=d.opts.interval;d.interLoop=d.opts.interLoop*d.total};d.run=function(){clearInterval(d.timer);d.timer=setTimeout(function(){d.showItem(d.curIdx+1);if(d.interLoop>0){d.interLoop--;d.run()}else{d.go()}},d.interval)};d.go=function(){clearInterval(d.timer);d.interval=d.interval<d.opts.intervalMin?d.opts.intervalMin:d.interval;d.interval=d.interval>d.opts.intervalMax?d.opts.intervalMax:d.interval;d.timer=setTimeout(function(){var e=(d.curIdx+1>d.total)?1:d.curIdx+1;d.showItem(e);d.interval+=d.opts.intervalStep;if(e==d.endNum){d.stop()}else{d.go()}},d.interval)};d.update=function(f,e){d.opts=f;if(e){d.init()}};d.init()};a.ecdloy.defaults={cssItem:".loy_item",clItemActive:"loy_item_on",spinner:"",interRlt:6000,interLoop:3,onStart:a.noop,onWin:a.noop,complete:a.noop,error:a.noop,sn:0,intervalMin:30,intervalMax:1000,interval:40,intervalStep:20};a.fn.ecdloy=function(b){if(this.length){return this.each(function(){(new a.ecdloy(this,b))})}}})(jQuery);